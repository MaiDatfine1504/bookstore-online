{% extends 'layouts/base.html' %}

{% block style %}
<style>
    body {
        font-family: 'Times New Roman', Times, serif;
    }

    .navbar-nav {
        margin: 0 auto;
    }

    .tab-content {
        margin-top: 20px;
    }

    .footer {
        background-color: #f1f1f1;
        text-align: center;
        padding: 20px 0;
        margin-top: 40px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Thanh to√°n</h2>

    <ul class="nav nav-tabs" id="checkoutTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if tab == 'cart' %}active{% endif %}" id="cart-tab" data-bs-toggle="tab" href="#cart" role="tab">üõí Xem gi·ªè h√†ng</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if tab == 'method' %}active{% endif %}" id="method-tab" data-bs-toggle="tab" href="#method" role="tab">üí≥ Ch·ªçn h√¨nh th·ª©c thanh to√°n</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if tab == 'address' %}active{% endif %}" id="address-tab" data-bs-toggle="tab" href="#address" role="tab">üè† ƒê·ªãa ch·ªâ giao h√†ng</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {% if tab == 'result' %}active{% endif %}" id="result-tab" data-bs-toggle="tab" href="#result" role="tab">‚úÖ K·∫øt qu·∫£</a>
        </li>
    </ul>

    <div class="tab-content" id="checkoutTabsContent">
        <!-- Cart Tab -->
        <div class="tab-pane fade {% if tab == 'cart' %}show active{% endif %}" id="cart" role="tabpanel">
            <h4>Gi·ªè h√†ng c·ªßa b·∫°n</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>S√°ch</th>
                        <th>T√°c gi·∫£</th>
                        <th>Gi√°</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>T·ªïng</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart %}
                    <tr>
                        <td>{{ item.title }}</td>
                        <td>{{ item.author }}</td>
                        <td>{{ "{:,.0f}".format(item.price) }}ƒë</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ "{:,.0f}".format(item.price * item.quantity) }}ƒë</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Payment Method Tab -->
        <div class="tab-pane fade {% if tab == 'method' %}show active{% endif %}" id="method" role="tabpanel">
            <h4>Ch·ªçn h√¨nh th·ª©c thanh to√°n</h4>
            <form method="POST" action="{{ url_for('checkout') }}">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" id="online" value="online" required>
                    <label class="form-check-label" for="online">Thanh to√°n Online</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" id="offline" value="offline" required>
                    <label class="form-check-label" for="offline">Thanh to√°n khi nh·∫≠n h√†ng</label>
                </div>
                <button type="submit" class="btn btn-primary mt-3">X√°c nh·∫≠n h√¨nh th·ª©c thanh to√°n</button>
            </form>
        </div>

        <!-- Address Tab -->
        <div class="tab-pane fade {% if tab == 'address' %}show active{% endif %}" id="address" role="tabpanel">
            <h4>ƒê·ªãa ch·ªâ giao h√†ng</h4>
            <form method="POST" action="{{ url_for('submit_address') }}">
                <div class="mb-3">
                    <label for="house_number" class="form-label">S·ªë nh√†</label>
                    <input type="text" class="form-control" id="house_number" name="house_number" value="{{ address.house_number if address }}" required>
                </div>
                <div class="mb-3">
                    <label for="street" class="form-label">T√™n ƒë∆∞·ªùng</label>
                    <input type="text" class="form-control" id="street" name="street" value="{{ address.street if address }}" required>
                </div>
                <div class="mb-3">
                    <label for="ward" class="form-label">Ph∆∞·ªùng</label>
                    <input type="text" class="form-control" id="ward" name="ward" value="{{ address.ward if address }}" required>
                </div>
                <div class="mb-3">
                    <label for="district" class="form-label">Qu·∫≠n</label>
                    <input type="text" class="form-control" id="district" name="district" value="{{ address.district if address }}" required>
                </div>
                <div class="mb-3">
                    <label for="city" class="form-label">Th√†nh ph·ªë</label>
                    <input type="text" class="form-control" id="city" name="city" value="{{ address.city if address }}" required>
                </div>
                <div class="mb-3">
                    <label for="country" class="form-label">Qu·ªëc gia</label>
                    <input type="text" class="form-control" id="country" name="country" value="{{ address.country if address }}" required>
                </div>
                <button type="submit" class="btn btn-success">L∆∞u ƒë·ªãa ch·ªâ</button>
            </form>
        </div>

        <!-- Result Tab -->
        <div class="tab-pane fade {% if tab == 'result' %}show active{% endif %}" id="result" role="tabpanel">
            <h4>K·∫øt qu·∫£ thanh to√°n</h4>
            {% if receipt %}
            <p>M√£ h√≥a ƒë∆°n: <strong>{{ receipt.id }}</strong></p>
            <p>T·ªïng ti·ªÅn: <strong>{{ "{:,.0f}".format(receipt.total_price) }}ƒë</strong></p>
            <p>Ph∆∞∆°ng th·ª©c: <strong>{{ payment_method|capitalize }}</strong></p>
            <h5>Chi ti·∫øt h√≥a ƒë∆°n</h5>
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>S√°ch</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>ƒê∆°n gi√°</th>
                        <th>Th√†nh ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in receipt.details %}
                    <tr>
                        <td>{{ d.book.title }}</td>
                        <td>{{ d.quantity }}</td>
                        <td>{{ "{:,.0f}".format(d.unit_price) }}ƒë</td>
                        <td>{{ "{:,.0f}".format(d.quantity * d.unit_price) }}ƒë</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>Ch∆∞a c√≥ h√≥a ƒë∆°n ƒë·ªÉ hi·ªÉn th·ªã.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const activeTab = "{{ tab }}";
        if (activeTab) {
            const tabTrigger = document.querySelector(`#${activeTab}-tab`);
            if (tabTrigger) new bootstrap.Tab(tabTrigger).show();
        }
    });
</script>
{% endblock %}